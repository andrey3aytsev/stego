function fraction_2_bin(t){var e=Math.round(255*t);return e=add_zeros(e.toString(2),8)}function add_zeros(t,e){return t=t.toString(),t.length<e?add_zeros("0"+t,e):t}function download_canvas(){var t=canvas.toDataURL();this.href=t}var ABC={toAscii:function(t){return t.replace(/\s*[01]{8}\s*/g,function(t){return String.fromCharCode(parseInt(t,2))})},toBinary:function(t,e){return t.replace(/[\s\S]/g,function(t){return t=ABC.zeroPad(t.charCodeAt().toString(2)),0==e?t:t})},zeroPad:function(t){return"00000000".slice(String(t).length)+t}},canvas=document.getElementById("canvas-pixels"),ctx=canvas.getContext("2d");document.getElementById("btn-download").addEventListener("click",download_canvas,!1);var text="Their cat drinks milk.",text_bin=ABC.toBinary(text),text_index=0;console.log(text_bin);var source_img=document.getElementById("mona"),source_img_width=source_img.clientWidth,source_img_height=source_img.clientHeight;ctx.canvas.width=source_img_width,ctx.canvas.height=source_img_height;var pix_wid=1/source_img_width*100,raster=new Raster("mona"),colors_cont=$("#bin"),pix_block=$("#pix_block"),pixels_colors=[],lsb=[];raster.on("load",function(){raster.size=new Size(source_img_width,source_img_height);for(var t=0;t<raster.height;t++)for(var e=0;e<raster.width;e++){var n=raster.getPixel(e,t),i=fraction_2_bin(n.red),r=fraction_2_bin(n.green),o=fraction_2_bin(n.blue);lsb.push(i.slice(-1)),lsb.push(r.slice(-1)),lsb.push(i.slice(-1));var s=i,a=r,c=o;pixels_colors.push([i,r,o]),text_index<=text_bin.length&&(s=i.substring(0,i.length-1)+text_bin[text_index]),text_index+1<=text_bin.length&&(a=r.substring(0,r.length-1)+text_bin[text_index+1]),text_index+2<=text_bin.length&&(c=o.substring(0,o.length-1)+text_bin[text_index+2]),text_index+=3,ctx.fillStyle="rgb("+ +parseInt(s,2)+","+parseInt(a,2)+","+parseInt(c,2)+");",ctx.fillRect(e,t,1,1)}}),setTimeout(function(){for(var t=0;t<lsb.length;t+=8);},5e3);